FROM php:8.0-apache

COPY ./overflow.c /home/steve/overflow.c
COPY ./overflow_redacted.c /home/steve/overflow_redacted.c
COPY ./index.html /var/www/html/index.html
RUN apt update
RUN echo 'Y' | apt install build-essential
RUN echo 'Y' | apt install gcc-multilib
RUN apt update && apt install openssh-server sudo -y
RUN useradd -rm -d /home/steve -s /bin/bash -u 1001 steve
RUN gcc /home/steve/overflow.c -o /home/steve/application -fno-stack-protector -m32
RUN echo 'steve:password123' | chpasswd
RUN rm /home/steve/overflow.c
RUN service ssh start
EXPOSE 80
EXPOSE 22
ADD ./startup.sh /opt/startup.sh
RUN chmod +x /opt/startup.sh
ENTRYPOINT ["/opt/startup.sh"]